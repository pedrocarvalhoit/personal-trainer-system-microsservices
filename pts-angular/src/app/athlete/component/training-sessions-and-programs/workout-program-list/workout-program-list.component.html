<!-- Toast -->
<div class="toast-overlay" *ngIf="successMessage">
  <div class="toast-message">{{ successMessage }}</div>
</div>

<div class="container mt-4">
  <div class="row">
    <!-- Coluna da esquerda -->
    <div class="col-md-6 d-flex flex-column">
      <div class="card assessment-card flex-grow-1">
        <div class="card-header text-white text-center">Workout Program Selected</div>
        <div class="card-body" *ngIf="selectedProgram; else noSelection">
          <p><strong>Title:</strong> {{ selectedProgram.title}}</p>
          <p><strong>Start Date:</strong> {{ selectedProgram.startDate | date: 'dd/MM/yyyy' }}</p>
          <p><strong>End Date:</strong> {{ selectedProgram.endDate | date: 'dd/MM/yyyy' }}</p>
          <p><strong>Content:</strong></p>
          <div [innerHTML]="getSafeContent(selectedProgram.trainingSessionContent)"></div>

          <p><strong>Note:</strong> {{ selectedProgram.note}}</p>
          <p><strong>Enabled:</strong> {{ selectedProgram.enabled ? 'Sim' : 'Não' }}</p>
        </div>
        <ng-template #noSelection>
          <div class="text-muted p-3">Select some workout program.</div>
        </ng-template>
      </div>
    </div>

    <!-- Coluna da direita -->
    <div class="col-md-6 d-flex flex-column">
      <div class="card assessment-card flex-grow-1">
        <div class="card-header text-white text-center d-flex justify-content-between align-items-center">
          Programs
          <!-- ✅ botão de filtro -->
          <button class="btn btn-sm btn-warning" (click)="toggleFilter()">
            Show {{ showEnabled ? 'Disabled' : 'Enabled' }}
          </button>
        </div>
        <div class="card-body p-0 history-list">
          <ul class="list-group list-group-flush">
            <li
              class="list-group-item list-item-click d-flex justify-content-between align-items-center"
              *ngFor="let program of filteredPrograms"
              (click)="selectProgram(program)"
              [class.active-item]="program.id === selectedProgram?.id"
            >
              <span>{{ program.startDate | date: 'dd/MM/yyyy' }}</span>
              <div class="d-flex">
            <button class="btn btn-sm btn-outline-primary me-1"
                    (click)="downloadPdf(program.id, program.title)">PDF</button>
            <button class="btn btn-sm btn-outline-primary"
                    (click)="openEditDialog(program)">Details / Edit</button>
          </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Edit -->
<div class="modal-overlay" *ngIf="editDialogOpen">
  <div class="modal-dialog">
    <!-- Botão fechar -->
    <button class="btn btn-light btn-sm close-btn" type="button" (click)="closeEditDialog()">✖</button>

    <h5 class="mb-3">Edit Program Data</h5>

    <label class="form-label">Title</label>
    <input type="text" class="form-control mb-2" [(ngModel)]="editingProgram.title">

    <label class="form-label">Start Date</label>
    <input type="date" class="form-control mb-2" [(ngModel)]="editingProgram.startDate">

    <label class="form-label">End Date</label>
    <input type="date" class="form-control mb-2" [(ngModel)]="editingProgram.endDate">

    <label class="form-label">Training Session Content</label>
    <editor
      [(ngModel)]="editingProgram.trainingSessionContent"
      [init]="tinyMceConfig"
      name="trainingSessionContent"
      apiKey="869mx4epb38d4q90d17q59aq7jpfallz5ix80kxg38yfnq58">
    </editor>

    <label class="form-label mt-2">Note</label>
    <input type="text" class="form-control mb-2" [(ngModel)]="editingProgram.note">

    <div class="form-check mt-2">
      <input type="checkbox" class="form-check-input" [(ngModel)]="editingProgram.enabled" id="enabledCheck">
      <label class="form-check-label" for="enabledCheck">Enabled</label>
    </div>

    <div class="d-flex justify-content-end mt-3">
      <button class="btn btn-secondary me-2" type="button" (click)="closeEditDialog()">Cancel</button>
      <button class="btn btn-primary" type="button" (click)="saveSession()">Save</button>
    </div>
  </div>
</div>
